<!DOCTYPE html>
<html lang="es-AR">

<head>
    <meta charset="UTF-8" />
    <title>Compra - Stella POS</title>
    <link rel="stylesheet" href="/css/ventas-form.css" />
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
</head>

<body>
    <form id="compraForm" method="post">
        <div id="alertas"></div>

        <header class="app-header">
            <h1><a th:href="@{/dashboard}">Stella POS</a> — Nueva Compra</h1>
            <div class="sale-info">
                <div>
                    <label>Caja: </label>
                    <input id="caja" type="text" th:value="${session.cajaNombre}" readonly>
                </div>
                <div>
                    <label>Usuario:</label>
                    <input disabled th:value="${nombreUsuario}" id="usuario">
                    <input type="hidden" id="nombreCajero" th:value="${nombreUsuario}">
                </div>
                <div>
                    <label>Fecha</label>
                    <input type="datetime-local" id="fechaCompra" />
                </div>
            </div>
        </header>

        <main class="container">
            <section class="add-item">
                <div class="row">
                    <div class="col" style="position:relative;">
                        <label>Código / Barras</label>
                        <input type="text" id="codigo" placeholder="Escanear o escribir" autocomplete="off" />
                        <div id="sugerencias" class="autocomplete-list"></div>
                    </div>
                    <div class="col flex-2">
                        <label>Descripción</label>
                        <input type="text" id="descripcion" placeholder="Nombre del producto" />
                    </div>
                    <div class="col">
                        <label>Cant.</label>
                        <input type="number" id="cantidad" min="1" value="1" />
                    </div>
                    <div class="col">
                        <label>Precio</label>
                        <input type="number" id="precio" min="0" step="0.01" />
                    </div>
                    <div class="col">
                        <label>IVA</label>
                        <select id="iva">
                            <option value="21" selected>21%</option>
                            <option value="10.5">10.5%</option>
                            <option value="0">Exento</option>
                        </select>
                    </div>
                    <div class="col">
                        <label>Desc. %</label>
                        <input type="number" id="descItem" min="0" max="100" value="0" />
                    </div>
                    <div class="col">
                        <button type="button" id="btnAgregar" class="primary">Agregar</button>
                    </div>
                </div>
            </section>

            <section class="cart">
                <table id="tablaCarrito">
                    <thead>
                        <tr>
                            <th>Código</th>
                            <th>Descripción</th>
                            <th class="num">Cant.</th>
                            <th class="num">Precio</th>
                            <th class="num">Desc. %</th>
                            <th class="num">IVA</th>
                            <th class="num">Subtotal</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </section>

            <section class="totals">
                <div class="left">
                    <label>Observaciones</label>
                    <textarea id="observaciones" rows="2" placeholder="Notas de la compra"></textarea>
                </div>
                <div class="right">
                    <div class="line">
                        <span>Subtotal (sin IVA)</span><strong id="subTotal">0.00</strong>
                    </div>
                    <div class="line">
                        <span>IVA</span><strong id="montoIVA">0.00</strong>
                    </div>
                    <div class="line total">
                        <span>Total</span><strong id="total">0.00</strong>
                    </div>
                    <div class="actions">
                        <button id="btnCancelar" class="danger" type="button">Cancelar</button>
                        <button id="btnFinalizar" class="success" type="button">Finalizar compra</button>
                    </div>
                </div>
            </section>
        </main>
    </form>

    <script th:src="@{/js/compras-form.js}"></script>
</body>

</html>